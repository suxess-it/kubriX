apiVersion: openidclient.keycloak.crossplane.io/v1alpha1
kind: Client
metadata:
  name: backstage-codespaces
spec:
  deletionPolicy: Delete
  forProvider:
    accessType: CONFIDENTIAL 
    clientId: backstage-codespaces
    name: backstage-codespaces
    realmId: sx-cnp-oss-codespaces
    directAccessGrantsEnabled: false
    standardFlowEnabled: true
    serviceAccountsEnabled: true
  #    managementPolicies: ["Observe"]
    validRedirectUris:
      - "http://localhost:7007/api/auth/oidc/handler/frame"
      - "https://BACKSTAGE_CODESPACES_REPLACE/api/auth/oidc/handler/frame"
    clientSecretSecretRef:
      key: backstage-codespaces
      name: "sx-keycloak-client-backstage-codespaces-password"
      namespace: keycloak
    loginTheme: keycloak
  providerConfigRef:
    name: "sx-keycloak-config"
---
apiVersion: realm.keycloak.crossplane.io/v1alpha1
kind: Realm
metadata:
  name: sx-cnp-oss-codespaces
  labels:
    platform-engineer.cloud/realm: sx-cnp-oss-codespaces
spec:
  forProvider:
    realm: sx-cnp-oss-codespaces
    displayName: sx-cnp-oss-codespaces
    attributes:
      frontendUrl: https://KEYCLOAK_CODESPACES_REPLACE
  deletionPolicy: "Delete"
  providerConfigRef:
    name: "sx-keycloak-config"
---
apiVersion: user.keycloak.crossplane.io/v1alpha1
kind: User
metadata:
  name: demouser
spec:
  forProvider:
    realmId: sx-cnp-oss-codespaces
    username: demouser
    enabled: true
    emailVerified: true
    firstName: demo
    lastName: user
    email: "demouser@platform-engineer.cloud"
    initialPassword:
      - valueSecretRef:
          name: "sx-keycloak-initial-passwords"
          key: demouser
          namespace: keycloak
        temporary: false # should be set to true in production
  deletionPolicy: "Delete"
  providerConfigRef:
    name: "sx-keycloak-config"
---
apiVersion: group.keycloak.crossplane.io/v1alpha1
kind: Group
metadata:
  name: team1
spec:
  forProvider:
    realmId: sx-cnp-oss-codespaces
    name: team1
  deletionPolicy: "Delete"
  providerConfigRef:
    name: "sx-keycloak-config"
---
apiVersion: group.keycloak.crossplane.io/v1alpha1
kind: Memberships
metadata:
  name: backstage-codespaces-team1-users-memberships
spec:
  forProvider:
    groupIdRef:
      name: team1
    members:
      - demouser
    realmId: sx-cnp-oss-codespaces
  providerConfigRef:
    name: "sx-keycloak-config"