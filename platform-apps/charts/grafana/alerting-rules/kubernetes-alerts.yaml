apiVersion: 1

groups:
    - orgId: 1
      name: kube-apiserver-slos
      folder: kubernetes-monitoring
      interval: 1m
      rules:
        - uid: KubeAPIErrorBudgetBurnCrit1h
          title: KubeAPIErrorBudgetBurnCrit1h
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum by(cluster) (apiserver_request:burnrate1h) > (14.40 * 0.01000)
                  and on(cluster)
                  sum by(cluster) (apiserver_request:burnrate5m) > (14.40 * 0.01000)
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 2m
          annotations:
            description: The API server is burning too much error budget.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeapierrorbudgetburn
            summary: The API server is burning too much error budget.
          labels:
            severity: critical
            long: 1h
            short: 5m
          isPaused: false

        - uid: KubeAPIErrorBudgetBurnCrit6h
          title: KubeAPIErrorBudgetBurnCrit6h
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum by(cluster) (apiserver_request:burnrate6h) > (6.00 * 0.01000)
                  and on(cluster)
                  sum by(cluster) (apiserver_request:burnrate30m) > (6.00 * 0.01000)
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: The API server is burning too much error budget.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeapierrorbudgetburn
            summary: The API server is burning too much error budget.
          labels:
            severity: critical
            long: 6h
            short: 30m
          isPaused: false

        - uid: KubeAPIErrorBudgetBurnWarn1d
          title: KubeAPIErrorBudgetBurnWarn1d
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum by(cluster) (apiserver_request:burnrate1d) > (3.00 * 0.01000)
                  and on(cluster)
                  sum by(cluster) (apiserver_request:burnrate2h) > (3.00 * 0.01000)
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 1h
          annotations:
            description: The API server is burning too much error budget.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeapierrorbudgetburn
            summary: The API server is burning too much error budget.
          labels:
            severity: warning
            long: 1d
            short: 2h
          isPaused: false

        - uid: KubeAPIErrorBudgetBurnWarn3d
          title: KubeAPIErrorBudgetBurnWarnd3d
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum by(cluster) (apiserver_request:burnrate3d) > (1.00 * 0.01000)
                  and on(cluster)
                  sum by(cluster) (apiserver_request:burnrate6h) > (1.00 * 0.01000)
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 3h
          annotations:
            description: The API server is burning too much error budget.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeapierrorbudgetburn
            summary: The API server is burning too much error budget.
          labels:
            severity: warning
            long: 3d
            short: 6h
          isPaused: false

    - orgId: 1
      name: kubernetes-apps
      folder: kubernetes-monitoring
      interval: 1m
      rules:
        - uid: KubePodImagePullBackOff
          title: KubePodImagePullBackOff
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: max_over_time(kube_pod_container_status_waiting_reason{reason="ImagePullBackOff", job!=""}[5m]) >= 1
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: 'Pod {{ $labels.namespace }}/{{ $labels.pod }} ({{ $labels.container }}) is in waiting state (reason: "ImagePullBackOff").'
            runbook_url: 'no runbook available'
            summary: Pod cannot pull the image
          labels:
            severity: warning
          isPaused: false

        - uid: KubePodCrashLooping
          title: KubePodCrashLooping
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: max_over_time(kube_pod_container_status_waiting_reason{reason="CrashLoopBackOff", job!=""}[5m]) >= 1
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: 'Pod {{ $labels.namespace }}/{{ $labels.pod }} ({{ $labels.container }}) is in waiting state (reason: "CrashLoopBackOff").'
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubepodcrashlooping
            summary: Pod is crash looping.
          labels:
            severity: warning
          isPaused: false

        - uid: KubePodNotReady
          title: KubePodNotReady
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum by (namespace, pod, job, cluster) (
                    max by(namespace, pod, job, cluster) (
                      kube_pod_status_phase{job!="", phase=~"Pending|Unknown|Failed"}
                    ) * on(namespace, pod, cluster) group_left(owner_kind) topk by(namespace, pod, cluster) (
                      1, max by(namespace, pod, owner_kind, cluster) (kube_pod_owner{owner_kind!="Job"})
                    )
                  ) > 0
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Pod {{ $labels.namespace }}/{{ $labels.pod }} has been in a non-ready state for longer than 15 minutes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubepodnotready
            summary: Pod has been in a non-ready state for more than 15 minutes.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeDeploymentGenerationMismatch
          title: KubeDeploymentGenerationMismatch
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_deployment_status_observed_generation{job!=""}
                    !=
                  kube_deployment_metadata_generation{job!=""}
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Deployment generation for {{ $labels.namespace }}/{{ $labels.deployment }} does not match, this indicates that the Deployment has failed but has not been rolled back.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubedeploymentgenerationmismatch
            summary: Deployment generation mismatch due to possible roll-back.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeDeploymentReplicasMismatch
          title: KubeDeploymentReplicasMismatch
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (
                    kube_deployment_spec_replicas{job!=""}
                      >
                    kube_deployment_status_replicas_available{job!=""}
                  ) and (
                    changes(kube_deployment_status_replicas_updated{job!=""}[10m])
                      ==
                    0
                  )
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Deployment {{ $labels.namespace }}/{{ $labels.deployment }} has not matched the expected number of replicas for longer than 15 minutes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubedeploymentreplicasmismatch
            summary: Deployment has not matched the expected number of replicas.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeDeploymentRolloutStuck
          title: KubeDeploymentRolloutStuck
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_deployment_status_condition{condition="Progressing", status="false",job!=""} != 0
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Rollout of deployment {{ $labels.namespace }}/{{ $labels.deployment }} is not progressing for longer than 15 minutes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubedeploymentrolloutstuck
            summary: Deployment rollout is not progressing.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeStatefulSetReplicasMismatch
          title: KubeStatefulSetReplicasMismatch
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (
                    kube_statefulset_status_replicas_ready{job!=""}
                      !=
                    kube_statefulset_status_replicas{job!=""}
                  ) and (
                    changes(kube_statefulset_status_replicas_updated{job!=""}[10m])
                      ==
                    0
                  )
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: StatefulSet {{ $labels.namespace }}/{{ $labels.statefulset }} has not matched the expected number of replicas for longer than 15 minutes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubestatefulsetreplicasmismatch
            summary: StatefulSet has not matched the expected number of replicas.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeStatefulSetGenerationMismatch
          title: KubeStatefulSetGenerationMismatch
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_statefulset_status_observed_generation{job!=""}
                    !=
                  kube_statefulset_metadata_generation{job!=""}
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: StatefulSet generation for {{ $labels.namespace }}/{{ $labels.statefulset }} does not match, this indicates that the StatefulSet has failed but has not been rolled back.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubestatefulsetgenerationmismatch
            summary: StatefulSet generation mismatch due to possible roll-back.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeStatefulSetUpdateNotRolledOut
          title: KubeStatefulSetUpdateNotRolledOut
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (
                    max by(namespace, statefulset, job, cluster) (
                      kube_statefulset_status_current_revision{job!=""}
                        unless
                      kube_statefulset_status_update_revision{job!=""}
                    )
                      *
                    (
                      kube_statefulset_replicas{job!=""}
                        !=
                      kube_statefulset_status_replicas_updated{job!=""}
                    )
                  )  and (
                    changes(kube_statefulset_status_replicas_updated{job!=""}[5m])
                      ==
                    0
                  )
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: StatefulSet {{ $labels.namespace }}/{{ $labels.statefulset }} update has not been rolled out.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubestatefulsetupdatenotrolledout
            summary: StatefulSet update has not been rolled out.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeDaemonSetRolloutStuck
          title: KubeDaemonSetRolloutStuck
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (
                    (
                      kube_daemonset_status_current_number_scheduled{job!=""}
                      !=
                      kube_daemonset_status_desired_number_scheduled{job!=""}
                    ) or (
                      kube_daemonset_status_number_misscheduled{job!=""}
                      !=
                      0
                    ) or (
                      kube_daemonset_status_updated_number_scheduled{job!=""}
                      !=
                      kube_daemonset_status_desired_number_scheduled{job!=""}
                    ) or (
                      kube_daemonset_status_number_available{job!=""}
                      !=
                      kube_daemonset_status_desired_number_scheduled{job!=""}
                    )
                  ) and (
                    changes(kube_daemonset_status_updated_number_scheduled{job!=""}[5m])
                      ==
                    0
                  )
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: DaemonSet {{ $labels.namespace }}/{{ $labels.daemonset }} has not finished or progressed for at least 15 minutes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubedaemonsetrolloutstuck
            summary: DaemonSet rollout is stuck.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeContainerWaiting
          title: KubeContainerWaiting
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum by (namespace, pod, container, job, cluster) (kube_pod_container_status_waiting_reason{reason!="CrashLoopBackOff", job!=""}) > 0
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 1h
          annotations:
            description: 'pod/{{ $labels.pod }} in namespace {{ $labels.namespace }} on container {{ $labels.container}} has been in waiting state for longer than 1 hour. (reason: "{{ $labels.reason }}").'
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubecontainerwaiting
            summary: Pod container waiting longer than 1 hour.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeDaemonSetNotScheduled
          title: KubeDaemonSetNotScheduled
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_daemonset_status_desired_number_scheduled{job!=""}
                    -
                  kube_daemonset_status_current_number_scheduled{job!=""} > 0
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 10m
          annotations:
            description: '{{ $value }} Pods of DaemonSet {{ $labels.namespace }}/{{ $labels.daemonset }} are not scheduled.'
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubedaemonsetnotscheduled
            summary: DaemonSet pods are not scheduled.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeDaemonSetMisScheduled
          title: KubeDaemonSetMisScheduled
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_daemonset_status_number_misscheduled{job!=""} > 0
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: '{{ $value }} Pods of DaemonSet {{ $labels.namespace }}/{{ $labels.daemonset }} are running where they are not supposed to run.'
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubedaemonsetmisscheduled
            summary: DaemonSet pods are misscheduled.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeJobNotCompleted
          title: KubeJobNotCompleted
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  time() - max by(namespace, job_name, cluster) (kube_job_status_start_time{job!=""}
                    and
                  kube_job_status_active{job!=""} > 0) > 43200
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          annotations:
            description: Job {{ $labels.namespace }}/{{ $labels.job_name }} is taking more than {{ "43200" | humanizeDuration }} to complete.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubejobnotcompleted
            summary: Job did not complete in time.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeJobFailed
          title: KubeJobFailed
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_job_failed{job!=""}  > 0
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Job {{ $labels.namespace }}/{{ $labels.job_name }} failed to complete. Removing failed job after investigation should clear this alert.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubejobfailed
            summary: Job failed to complete.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeHpaReplicasMismatch
          title: KubeHpaReplicasMismatch
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (kube_horizontalpodautoscaler_status_desired_replicas{job!=""}
                    !=
                  kube_horizontalpodautoscaler_status_current_replicas{job!=""})
                    and
                  (kube_horizontalpodautoscaler_status_current_replicas{job!=""}
                    >
                  kube_horizontalpodautoscaler_spec_min_replicas{job!=""})
                    and
                  (kube_horizontalpodautoscaler_status_current_replicas{job!=""}
                    <
                  kube_horizontalpodautoscaler_spec_max_replicas{job!=""})
                    and
                  changes(kube_horizontalpodautoscaler_status_current_replicas{job!=""}[15m]) == 0
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: HPA {{ $labels.namespace }}/{{ $labels.horizontalpodautoscaler  }} has not matched the desired number of replicas for longer than 15 minutes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubehpareplicasmismatch
            summary: HPA has not matched desired number of replicas.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeHpaMaxedOut
          title: KubeHpaMaxedOut
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_horizontalpodautoscaler_status_current_replicas{job!=""}
                    ==
                  kube_horizontalpodautoscaler_spec_max_replicas{job!=""}
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: HPA {{ $labels.namespace }}/{{ $labels.horizontalpodautoscaler  }} has been running at max replicas for longer than 15 minutes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubehpamaxedout
            summary: HPA is running at max replicas.
          labels:
            severity: warning
          isPaused: false

    - orgId: 1
      name: kubernetes-resources
      folder: kubernetes-monitoring
      interval: 1m
      rules:
        - uid: KubeCPUOvercommit
          title: KubeCPUOvercommit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum(namespace_cpu:kube_pod_container_resource_requests:sum{}) by (cluster) - (sum(kube_node_status_allocatable{job!="",resource="cpu"}) by (cluster) - max(kube_node_status_allocatable{job!="",resource="cpu"}) by (cluster)) > 0
                  and
                  (sum(kube_node_status_allocatable{job!="",resource="cpu"}) by (cluster) - max(kube_node_status_allocatable{job!="",resource="cpu"}) by (cluster)) > 0
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 10m
          annotations:
            description: Cluster {{ $labels.cluster }} has overcommitted CPU resource requests for Pods by {{ $value }} CPU shares and cannot tolerate node failure.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubecpuovercommit
            summary: Cluster has overcommitted CPU resource requests.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeMemoryOvercommit
          title: KubeMemoryOvercommit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum(namespace_memory:kube_pod_container_resource_requests:sum{}) by (cluster) - (sum(kube_node_status_allocatable{resource="memory", job!=""}) by (cluster) - max(kube_node_status_allocatable{resource="memory", job!=""}) by (cluster)) > 0
                  and
                  (sum(kube_node_status_allocatable{resource="memory", job!=""}) by (cluster) - max(kube_node_status_allocatable{resource="memory", job!=""}) by (cluster)) > 0
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 10m
          annotations:
            description: Cluster {{ $labels.cluster }} has overcommitted memory resource requests for Pods by {{ $values.A.Value | humanize }} bytes and cannot tolerate node failure.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubememoryovercommit
            summary: Cluster has overcommitted memory resource requests.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeCPUQuotaOvercommit
          title: KubeCPUQuotaOvercommit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum(min without(resource) (kube_resourcequota{job!="", type="hard", resource=~"(cpu|requests.cpu)"})) by (cluster)
                    /
                  sum(kube_node_status_allocatable{resource="cpu", job!=""}) by (cluster)
                    > 1.5
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            description: Cluster {{ $labels.cluster }}  has overcommitted CPU resource requests for Namespaces.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubecpuquotaovercommit
            summary: Cluster has overcommitted CPU resource requests.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeMemoryQuotaOvercommit
          title: KubeMemoryQuotaOvercommit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum(min without(resource) (kube_resourcequota{job!="", type="hard", resource=~"(memory|requests.memory)"})) by (cluster)
                    /
                  sum(kube_node_status_allocatable{resource="memory", job!=""}) by (cluster)
                    > 1.5
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            description: Cluster {{ $labels.cluster }}  has overcommitted memory resource requests for Namespaces.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubememoryquotaovercommit
            summary: Cluster has overcommitted memory resource requests.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeQuotaAlmostFull
          title: KubeQuotaAlmostFull
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_resourcequota{job!="", type="used"}
                    / ignoring(instance, job, type)
                  (kube_resourcequota{job!="", type="hard"} > 0)
                    > 0.9 < 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Namespace {{ $labels.namespace }} is using {{ $values.A.Value | humanizePercentage }} of its {{ $labels.resource }} quota.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubequotaalmostfull
            summary: Namespace quota is going to be full.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeQuotaFullyUsed
          title: KubeQuotaFullyUsed
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_resourcequota{job!="", type="used"}
                    / ignoring(instance, job, type)
                  (kube_resourcequota{job!="", type="hard"} > 0)
                    == 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Namespace {{ $labels.namespace }} is using {{ $values.A.Value | humanizePercentage }} of its {{ $labels.resource }} quota.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubequotafullyused
            summary: Namespace quota is fully used.
          labels:
            severity: info
          isPaused: false

        - uid: KubeQuotaExceeded
          title: KubeQuotaExceeded
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_resourcequota{job!="", type="used"}
                    / ignoring(instance, job, type)
                  (kube_resourcequota{job!="", type="hard"} > 0)
                    > 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Namespace {{ $labels.namespace }} is using {{ $values.A.Value | humanizePercentage }} of its {{ $labels.resource }} quota.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubequotaexceeded
            summary: Namespace quota has exceeded the limits.
          labels:
            severity: warning
          isPaused: false

        - uid: CPUThrottlingHigh
          title: CPUThrottlingHigh
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: code
                expr: |-
                    sum(increase(container_cpu_cfs_throttled_periods_total{container!="", }[5m])) by (cluster, container, pod, namespace)
                    /
                    sum(increase(container_cpu_cfs_periods_total{}[5m])) by (cluster, container, pod, namespace)
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
            - refId: C
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0.25
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: '{{ humanizePercentage $values.A.Value }} throttling of CPU in cluster {{ $labels.cluster }} namespace {{ $labels.namespace }} for container {{ $labels.container }} in pod {{ $labels.pod }}.'
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-cputhrottlinghigh
            summary: Processes experience elevated CPU throttling.
          labels:
            severity: info
          isPaused: false

    - orgId: 1
      name: kubernetes-storage
      folder: kubernetes-monitoring
      interval: 1m
      rules:
        - uid: KubePersistentVolumeFillingUpCrit
          title: KubePersistentVolumeFillingUpCrit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (
                    kubelet_volume_stats_available_bytes{job!=""}
                      /
                    kubelet_volume_stats_capacity_bytes{job!=""}
                  ) < 0.03
                  and
                  kubelet_volume_stats_used_bytes{job!=""} > 0
                  unless on(cluster, namespace, persistentvolumeclaim)
                  kube_persistentvolumeclaim_access_mode{ access_mode="ReadOnlyMany"} == 1
                  unless on(cluster, namespace, persistentvolumeclaim)
                  kube_persistentvolumeclaim_labels{label_excluded_from_alerts="true"} == 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 1m
          annotations:
            description: The PersistentVolume claimed by {{ $labels.persistentvolumeclaim }} in Namespace {{ $labels.namespace }} {{ with $labels.cluster -}} on Cluster {{ . }} {{- end }} is only {{ $values.A.Value | humanizePercentage }} free.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubepersistentvolumefillingup
            summary: PersistentVolume is filling up.
          labels:
            severity: critical
          isPaused: false

        - uid: KubePersistentVolumeFillingUpWarn
          title: KubePersistentVolumeFillingUpWarn
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (
                    kubelet_volume_stats_available_bytes{job!=""}
                      /
                    kubelet_volume_stats_capacity_bytes{job!=""}
                  ) < 0.15
                  and
                  kubelet_volume_stats_used_bytes{job!=""} > 0
                  and
                  predict_linear(kubelet_volume_stats_available_bytes{job!=""}[6h], 4 * 24 * 3600) < 0
                  unless on(cluster, namespace, persistentvolumeclaim)
                  kube_persistentvolumeclaim_access_mode{ access_mode="ReadOnlyMany"} == 1
                  unless on(cluster, namespace, persistentvolumeclaim)
                  kube_persistentvolumeclaim_labels{label_excluded_from_alerts="true"} == 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 1h
          annotations:
            description: Based on recent sampling, the PersistentVolume claimed by {{ $labels.persistentvolumeclaim }} in Namespace {{ $labels.namespace }} {{ with $labels.cluster -}} on Cluster {{ . }} {{- end }} is expected to fill up within four days. Currently {{ $values.A.Value | humanizePercentage }} is available.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubepersistentvolumefillingup
            summary: PersistentVolume is filling up.
          labels:
            severity: warning
          isPaused: false

        - uid: KubePersistentVolumeInodesFillingUpCrit
          title: KubePersistentVolumeInodesFillingUpCrit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (
                    kubelet_volume_stats_inodes_free{job!=""}
                      /
                    kubelet_volume_stats_inodes{job!=""}
                  ) < 0.03
                  and
                  kubelet_volume_stats_inodes_used{job!=""} > 0
                  unless on(cluster, namespace, persistentvolumeclaim)
                  kube_persistentvolumeclaim_access_mode{ access_mode="ReadOnlyMany"} == 1
                  unless on(cluster, namespace, persistentvolumeclaim)
                  kube_persistentvolumeclaim_labels{label_excluded_from_alerts="true"} == 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 1m
          annotations:
            description: The PersistentVolume claimed by {{ $labels.persistentvolumeclaim }} in Namespace {{ $labels.namespace }} {{ with $labels.cluster -}} on Cluster {{ . }} {{- end }} only has {{ $values.A.Value | humanizePercentage }} free inodes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubepersistentvolumeinodesfillingup
            summary: PersistentVolumeInodes are filling up.
          labels:
            severity: critical
          isPaused: false

        - uid: KubePersistentVolumeInodesFillingUpWarn
          title: KubePersistentVolumeInodesFillingUpWarn
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (
                    kubelet_volume_stats_inodes_free{job!=""}
                      /
                    kubelet_volume_stats_inodes{job!=""}
                  ) < 0.15
                  and
                  kubelet_volume_stats_inodes_used{job!=""} > 0
                  and
                  predict_linear(kubelet_volume_stats_inodes_free{job!=""}[6h], 4 * 24 * 3600) < 0
                  unless on(cluster, namespace, persistentvolumeclaim)
                  kube_persistentvolumeclaim_access_mode{ access_mode="ReadOnlyMany"} == 1
                  unless on(cluster, namespace, persistentvolumeclaim)
                  kube_persistentvolumeclaim_labels{label_excluded_from_alerts="true"} == 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 1m
          annotations:
            description: Based on recent sampling, the PersistentVolume claimed by {{ $labels.persistentvolumeclaim }} in Namespace {{ $labels.namespace }} {{ with $labels.cluster -}} on Cluster {{ . }} {{- end }} is expected to run out of inodes within four days. Currently {{ $values.A.Value | humanizePercentage }} of its inodes are free.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubepersistentvolumeinodesfillingup
            summary: PersistentVolumeInodes are filling up.
          labels:
            severity: warning
          isPaused: false

        - uid: KubePersistentVolumeErrors
          title: KubePersistentVolumeErrors
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: kube_persistentvolume_status_phase{phase=~"Failed|Pending",job!=""} > 0
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            description: The persistent volume {{ $labels.persistentvolume }} {{ with $labels.cluster -}} on Cluster {{ . }} {{- end }} has status {{ $labels.phase }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubepersistentvolumeerrors
            summary: PersistentVolume is having issues with provisioning.
          labels:
            severity: critical
          isPaused: false

    - orgId: 1
      name: kubernetes-system
      folder: kubernetes-monitoring
      interval: 1m
      rules:
        - uid: KubeVersionMismatch
          title: KubeVersionMismatch
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  count by (cluster) (count by (git_version, cluster) (label_replace(kubernetes_build_info{job!~"kube-dns|coredns"},"git_version","$1","git_version","(v[0-9]*.[0-9]*).*"))) > 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: There are {{ $value }} different semantic versions of Kubernetes components running.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeversionmismatch
            summary: Different semantic versions of Kubernetes components running.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeClientErrors
          title: KubeClientErrors
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (sum(rate(rest_client_requests_total{job!="",code=~"5.."}[5m])) by (cluster, instance, job, namespace)
                    /
                  sum(rate(rest_client_requests_total{job!=""}[5m])) by (cluster, instance, job, namespace))
                  > 0.01
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Kubernetes API server client '{{ $labels.job }}/{{ $labels.instance }}' is experiencing {{ $values.A.Value | humanizePercentage }} errors.'
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeclienterrors
            summary: Kubernetes API server client is experiencing errors.
          labels:
            severity: warning
          isPaused: false

    - orgId: 1
      name: kubernetes-system-apiserver
      folder: kubernetes-monitoring
      interval: 1m
      rules:
        - uid: KubeClientCertificateExpirationWarn
          title: KubeClientCertificateExpirationWarn
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  histogram_quantile(0.01, sum without (namespace, service, endpoint) (rate(apiserver_client_certificate_expiration_seconds_bucket{job!=""}[5m]))) < 604800
                  and
                  on(job, cluster, instance) apiserver_client_certificate_expiration_seconds_count{job!=""} > 0
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            description: A client certificate used to authenticate to kubernetes apiserver is expiring in less than 7.0 days on cluster {{ $labels.cluster }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeclientcertificateexpiration
            summary: Client certificate is about to expire.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeClientCertificateExpirationCrit
          title: KubeClientCertificateExpirationCrit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  histogram_quantile(0.01, sum without (namespace, service, endpoint) (rate(apiserver_client_certificate_expiration_seconds_bucket{job!=""}[5m]))) < 86400
                  and
                  on(job, cluster, instance) apiserver_client_certificate_expiration_seconds_count{job!=""} > 0
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            description: A client certificate used to authenticate to kubernetes apiserver is expiring in less than 24.0 hours on cluster {{ $labels.cluster }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeclientcertificateexpiration
            summary: Client certificate is about to expire.
          labels:
            severity: critical
          isPaused: false

        - uid: KubeAggregatedAPIErrors
          title: KubeAggregatedAPIErrors
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: sum by(cluster, instance, name, reason)(increase(aggregator_unavailable_apiservice_total{job!=""}[1m])) > 0
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 10m
          annotations:
            description: Kubernetes aggregated API {{ $labels.instance }}/{{ $labels.name }} has reported {{ $labels.reason }} errors on cluster {{ $labels.cluster }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeaggregatedapierrors
            summary: Kubernetes aggregated API has reported errors.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeAggregatedAPIDown
          title: KubeAggregatedAPIDown
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: (1 - max by(name, namespace, cluster)(avg_over_time(aggregator_unavailable_apiservice{job!=""}[10m]))) * 100 < 85
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            description: Kubernetes aggregated API {{ $labels.name }}/{{ $labels.namespace }} has been only {{ $values.A.Value | humanize }}% available over the last 10m.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeaggregatedapidown
            summary: Kubernetes aggregated API is down.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeAPIDown
          title: KubeAPIDown
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: absent(up{job!=""} == 1)
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: KubeAPI has disappeared from Prometheus target discovery.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeapidown
            summary: Target disappeared from Prometheus target discovery.
          labels:
            severity: critical
          isPaused: false

        - uid: KubeAPITerminatedRequests
          title: KubeAPITerminatedRequests
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: sum by(cluster) (rate(apiserver_request_terminations_total{job!=""}[10m])) / ( sum by(cluster) (rate(apiserver_request_total{job!=""}[10m])) + sum by(cluster) (rate(apiserver_request_terminations_total{job!=""}[10m])) ) > 0.20
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            description: The kubernetes apiserver has terminated {{ $values.A.Value | humanizePercentage }} of its incoming requests.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeapiterminatedrequests
            summary: The kubernetes apiserver has terminated {{ $values.A.Value | humanizePercentage }} of its incoming requests.
          labels:
            severity: warning
          isPaused: false

    - orgId: 1
      name: kubernetes-system-kubelet
      folder: kubernetes-monitoring
      interval: 1m
      rules:
        - uid: KubeNodeNotReady
          title: KubeNodeNotReady
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kube_node_status_condition{job!="",condition="Ready",status="true"} == 0
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: '{{ $labels.node }} has been unready for more than 15 minutes.'
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubenodenotready
            summary: Node is not ready.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeNodeUnreachable
          title: KubeNodeUnreachable
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  (kube_node_spec_taint{job!="",key="node.kubernetes.io/unreachable",effect="NoSchedule"} unless ignoring(key,value) kube_node_spec_taint{job!="",key=~"ToBeDeletedByClusterAutoscaler|cloud.google.com/impending-node-termination|aws-node-termination-handler/spot-itn"}) == 1
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: '{{ $labels.node }} is unreachable and some workloads may be rescheduled.'
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubenodeunreachable
            summary: Node is unreachable.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeletTooManyPods
          title: KubeletTooManyPods
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  count by(cluster, node) (
                    (kube_pod_status_phase{job!="",phase="Running"} == 1) * on(instance,pod,namespace,cluster) group_left(node) topk by(instance,pod,namespace,cluster) (1, kube_pod_info{job!=""})
                  )
                  /
                  max by(cluster, node) (
                    kube_node_status_capacity{job!="",resource="pods"} != 1
                  ) > 0.95
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Kubelet '{{ $labels.node }}' is running at {{ $values.A.Value | humanizePercentage }} of its Pod capacity.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubelettoomanypods
            summary: Kubelet is running at capacity.
          labels:
            severity: info
          isPaused: false

        - uid: KubeNodeReadinessFlapping
          title: KubeNodeReadinessFlapping
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  sum(changes(kube_node_status_condition{job!="",status="true",condition="Ready"}[15m])) by (cluster, node) > 2
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: The readiness status of node {{ $labels.node }} has changed {{ $value }} times in the last 15 minutes.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubenodereadinessflapping
            summary: Node readiness status is flapping.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeletPlegDurationHigh
          title: KubeletPlegDurationHigh
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile{quantile="0.99"} >= 10
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            description: The Kubelet Pod Lifecycle Event Generator has a 99th percentile duration of {{ $value }} seconds on node {{ $labels.node }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletplegdurationhigh
            summary: Kubelet Pod Lifecycle Event Generator is taking too long to relist.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeletPodStartUpLatencyHigh
          title: KubeletPodStartUpLatencyHigh
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  histogram_quantile(0.99, sum(rate(kubelet_pod_worker_duration_seconds_bucket{job!=""}[5m])) by (cluster, instance, le)) * on(cluster, instance) group_left(node) kubelet_node_name{job!=""} > 60
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Kubelet Pod startup 99th percentile latency is {{ $value }} seconds on node {{ $labels.node }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletpodstartuplatencyhigh
            summary: Kubelet Pod startup latency is too high.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeletClientCertificateExpirationWarn
          title: KubeletClientCertificateExpirationWarn
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kubelet_certificate_manager_client_ttl_seconds < 604800
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          annotations:
            description: Client certificate for Kubelet on node {{ $labels.node }} expires in {{ $values.A.Value | humanizeDuration }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletclientcertificateexpiration
            summary: Kubelet client certificate is about to expire.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeletClientCertificateExpirationCrit
          title: KubeletClientCertificateExpirationCrit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kubelet_certificate_manager_client_ttl_seconds < 86400
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          annotations:
            description: Client certificate for Kubelet on node {{ $labels.node }} expires in {{ $values.A.Value | humanizeDuration }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletclientcertificateexpiration
            summary: Kubelet client certificate is about to expire.
          labels:
            severity: critical
          isPaused: false

        - uid: KubeletServerCertificateExpirationWarn
          title: KubeletServerCertificateExpirationWarn
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kubelet_certificate_manager_server_ttl_seconds < 604800
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          annotations:
            description: Server certificate for Kubelet on node {{ $labels.node }} expires in {{ $values.A.Value | humanizeDuration }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletservercertificateexpiration
            summary: Kubelet server certificate is about to expire.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeletServerCertificateExpirationCrit
          title: KubeletServerCertificateExpirationCrit
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  kubelet_certificate_manager_server_ttl_seconds < 86400
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          annotations:
            description: Server certificate for Kubelet on node {{ $labels.node }} expires in {{ $values.A.Value | humanizeDuration }}.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletservercertificateexpiration
            summary: Kubelet server certificate is about to expire.
          labels:
            severity: critical
          isPaused: false

        - uid: KubeletClientCertificateRenewalErrors
          title: KubeletClientCertificateRenewalErrors
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  increase(kubelet_certificate_manager_client_expiration_renew_errors[5m]) > 0
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Kubelet on node {{ $labels.node }} has failed to renew its client certificate ({{ $values.A.Value | humanize }} errors in the last 5 minutes).
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletclientcertificaterenewalerrors
            summary: Kubelet has failed to renew its client certificate.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeletServerCertificateRenewalErrors
          title: KubeletServerCertificateRenewalErrors
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  increase(kubelet_server_expiration_renew_errors[5m]) > 0
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Kubelet on node {{ $labels.node }} has failed to renew its server certificate ({{ $values.A.Value | humanize }} errors in the last 5 minutes).
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletservercertificaterenewalerrors
            summary: Kubelet has failed to renew its server certificate.
          labels:
            severity: warning
          isPaused: false

        - uid: KubeletDown
          title: KubeletDown
          condition: A
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: mimir
              model:
                editorMode: builder
                expr: |
                  absent(up{job!=""} == 1)
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: A
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            description: Kubelet in Cluster {{ $labels.cluster }}, has disappeared from Prometheus target discovery.
            runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/tree/master/runbook.md#alert-name-kubeletdown
            summary: Target disappeared from Prometheus target discovery.
          labels:
            severity: critical
          isPaused: false
