apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: sx-cnp-secret
spec:
  refreshInterval: "15s"
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    name: sx-cnp-secret
    template:
      type: Opaque
      data:
        BACKEND_SECRET: "{{ `{{ .BACKEND_SECRET }}` }}"
        EXTERNAL_ACCESS_TOKEN: "{{ `{{ .EXTERNAL_ACCESS_TOKEN }}` }}"
        OIDC_CLIENTSECRET: "{{ `{{ .OIDC_CLIENTSECRET }}` }}"
        GITHUB_CLIENTID: "{{ `{{ .GITHUB_CLIENTID }}` }}"
        GITHUB_CLIENTSECRET: "{{ `{{ .GITHUB_CLIENTSECRET }}` }}"
        GITHUB_TOKEN: "{{ `{{ .GITHUB_TOKEN }}` }}"
        ARGOCD_AUTH_TOKEN: "{{ `{{ .ARGOCD_AUTH_TOKEN }}` }}"
        GRAFANA_TOKEN: "{{ `{{ .GRAFANA_TOKEN }}` }}"
        K8S_SA_TOKEN: "{{ `{{ .K8S_SA_TOKEN }}` }}"
      metadata:
        annotations:
          kubrix.io/install: "false"
  data:
  - secretKey: BACKEND_SECRET
    remoteRef:
      key: kubrix-kv/data/portal/backstage/base
      property: BACKEND_SECRET
  - secretKey: EXTERNAL_ACCESS_TOKEN
    remoteRef:
      key: kubrix-kv/data/portal/backstage/base
      property: EXTERNAL_ACCESS_TOKEN
  - secretKey: GITHUB_CLIENTID
    remoteRef:
      key: kubrix-kv/data/portal/backstage/base
      property: GITHUB_CLIENTID
  - secretKey: GITHUB_CLIENTSECRET
    remoteRef:
      key: kubrix-kv/data/portal/backstage/base
      property: GITHUB_CLIENTSECRET
  - secretKey: GITHUB_TOKEN
    remoteRef:
      key: kubrix-kv/data/portal/backstage/base
      property: GITHUB_TOKEN
  - secretKey: ARGOCD_AUTH_TOKEN
    remoteRef:
      key: kubrix-kv/data/portal/backstage/base
      property: ARGOCD_AUTH_TOKEN
  - secretKey: GRAFANA_TOKEN
    remoteRef:
      key: kubrix-kv/data/portal/backstage/base
      property: GRAFANA_TOKEN
  - secretKey: K8S_SA_TOKEN
    remoteRef:
      key: kubrix-kv/data/portal/backstage/base
      property: K8S_SA_TOKEN
  - secretKey: OIDC_CLIENTSECRET
    remoteRef:
      key: kubrix-kv/data/keycloak/oidc
      property: backstage
