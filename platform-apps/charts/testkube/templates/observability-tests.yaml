{{- if .Values.observabilityTests.enabled -}}
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: kind-observability
spec:
  steps:
    - run:
        image: "curlimages/curl:7.78.0"
        shell: |
          cat /etc/ssl/custom/ca.crt
          echo ${CURL_CA_BUNDLE}
          echo | openssl s_client -showcerts -servername grafana.127-0-0-1.nip.io -connect grafana.127-0-0-1.nip.io:443 2>/dev/null | openssl x509 -inform pem -noout -text
          curl https://grafana.127-0-0-1.nip.io
{{- end }}
